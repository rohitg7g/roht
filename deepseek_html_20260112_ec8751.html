<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Search App | Smart Search with Voice & Filters</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s, transform 0.2s;
        }

        :root {
            --primary-color: #4361ee;
            --primary-light: #e0e7ff;
            --secondary-color: #3a0ca3;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --gray-light: #e9ecef;
            --success-color: #4cc9f0;
            --success-dark: #2a9d8f;
            --danger-color: #f72585;
            --warning-color: #f8961e;
            --info-color: #4895ef;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --border-radius: 12px;
            --border-radius-sm: 8px;
        }

        .dark-mode {
            --primary-color: #4895ef;
            --primary-light: #1e3a8a;
            --secondary-color: #560bad;
            --light-color: #121212;
            --dark-color: #f8f9fa;
            --gray-color: #adb5bd;
            --gray-light: #2d2d2d;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(67, 97, 238, 0.05) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(244, 114, 182, 0.05) 0%, transparent 50%);
            z-index: -1;
            opacity: 0.7;
        }

        .dark-mode body::before {
            background: radial-gradient(circle at 20% 80%, rgba(67, 97, 238, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(244, 114, 182, 0.1) 0%, transparent 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header with gradient */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 0;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.6rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .logo i {
            font-size: 2rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 50%;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-toggle, .voice-search-btn, .search-filter-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .menu-toggle:hover, .voice-search-btn:hover, .search-filter-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        /* Sidebar Menu with gradient */
        .sidebar {
            position: fixed;
            top: 0;
            left: -350px;
            width: 320px;
            height: 100vh;
            background: linear-gradient(180deg, var(--light-color) 0%, var(--light-color) 100%);
            color: var(--dark-color);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: left 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            overflow-y: auto;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .dark-mode .sidebar {
            background: linear-gradient(180deg, #1a1a1a 0%, #121212 100%);
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-light);
        }

        .sidebar-title {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .close-menu {
            background: var(--gray-light);
            border: none;
            color: var(--dark-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-menu:hover {
            background: var(--primary-color);
            color: white;
            transform: rotate(90deg);
        }

        .menu-items {
            list-style: none;
            flex-grow: 1;
        }

        .menu-item {
            margin-bottom: 12px;
        }

        .menu-item a {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 18px;
            border-radius: var(--border-radius-sm);
            color: var(--dark-color);
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .menu-item a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(67, 97, 238, 0.1), transparent);
            transition: left 0.7s;
        }

        .menu-item a:hover::before {
            left: 100%;
        }

        .menu-item a:hover, .menu-item.active a {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        .menu-item i {
            width: 25px;
            text-align: center;
            font-size: 1.2rem;
        }

        .menu-badge {
            background-color: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 20px;
            margin-left: auto;
        }

        .sidebar-footer {
            padding-top: 20px;
            border-top: 2px solid var(--gray-light);
            text-align: center;
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Main Content */
        .main-content {
            padding: 40px 0;
            min-height: calc(100vh - 140px);
        }

        /* Enhanced Search Section */
        .search-section {
            text-align: center;
            margin-bottom: 50px;
        }

        .search-title {
            font-size: 3rem;
            margin-bottom: 15px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 900;
        }

        .search-subtitle {
            font-size: 1.2rem;
            color: var(--gray-color);
            margin-bottom: 40px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .search-container {
            max-width: 850px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 30px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .dark-mode .search-container {
            background-color: #1e1e1e;
        }

        .search-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color), var(--success-color));
        }

        .search-features {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .feature-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: var(--primary-light);
            color: var(--primary-color);
            padding: 10px 18px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .dark-mode .feature-badge {
            background-color: var(--primary-light);
        }

        /* Search Filter Modal */
        .filter-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background-color: var(--light-color);
            color: var(--dark-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .filter-modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-light);
        }

        .filter-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .close-filter {
            background: none;
            border: none;
            color: var(--dark-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-filter:hover {
            background-color: var(--gray-light);
        }

        .filter-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-label {
            font-weight: 600;
            color: var(--dark-color);
        }

        .filter-select, .filter-input {
            padding: 12px 15px;
            border-radius: var(--border-radius-sm);
            border: 2px solid var(--gray-light);
            background-color: var(--light-color);
            color: var(--dark-color);
            font-size: 1rem;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 25px;
            border-radius: var(--border-radius-sm);
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-secondary {
            background-color: var(--gray-light);
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background-color: var(--gray-color);
            color: white;
        }

        /* Voice Search Interface */
        .voice-interface {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background-color: var(--light-color);
            color: var(--dark-color);
            border-radius: 50%;
            box-shadow: var(--shadow-lg);
            width: 300px;
            height: 300px;
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 30px;
        }

        .voice-interface.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .voice-icon {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .voice-listening {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .voice-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .voice-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--dark-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-close:hover {
            background-color: var(--gray-light);
        }

        /* History Section */
        .section-title {
            font-size: 2rem;
            margin-bottom: 25px;
            color: var(--primary-color);
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title i {
            background-color: var(--primary-light);
            padding: 12px;
            border-radius: 50%;
        }

        .history-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-history-input {
            flex-grow: 1;
            max-width: 300px;
            padding: 12px 20px;
            border-radius: var(--border-radius-sm);
            border: 2px solid var(--gray-light);
            background-color: var(--light-color);
            color: var(--dark-color);
            font-size: 1rem;
        }

        .history-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .history-section, .about-section, .favorites-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .dark-mode .history-section, 
        .dark-mode .about-section,
        .dark-mode .favorites-section {
            background-color: #1e1e1e;
        }

        .history-list {
            list-style: none;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .history-list::-webkit-scrollbar {
            width: 8px;
        }

        .history-list::-webkit-scrollbar-track {
            background: var(--gray-light);
            border-radius: 10px;
        }

        .history-list::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-radius: var(--border-radius-sm);
            margin-bottom: 15px;
            background-color: var(--gray-light);
            border-left: 5px solid var(--primary-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .history-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .history-item.favorite {
            border-left-color: var(--warning-color);
        }

        .history-item-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .history-query {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-query i {
            color: var(--primary-color);
        }

        .history-time {
            font-size: 0.9rem;
            color: var(--gray-color);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .history-actions-container {
            display: flex;
            gap: 10px;
        }

        .history-btn {
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            font-size: 1.1rem;
            padding: 10px;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .history-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
            transform: scale(1.1);
        }

        .favorite-btn:hover {
            color: var(--warning-color);
        }

        .delete-btn:hover {
            color: var(--danger-color);
        }

        .export-btn:hover {
            color: var(--success-dark);
        }

        .no-history, .no-favorites {
            text-align: center;
            color: var(--gray-color);
            padding: 50px 30px;
            font-style: italic;
            font-size: 1.2rem;
        }

        .no-history i, .no-favorites i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--gray-light);
        }

        /* Favorites Section */
        .favorites-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            flex: 1;
            min-width: 200px;
            box-shadow: var(--shadow);
        }

        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* About Section */
        .about-content {
            line-height: 1.7;
            color: var(--dark-color);
        }

        .about-content p {
            margin-bottom: 20px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 35px;
        }

        .feature {
            background-color: var(--gray-light);
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            transition: var(--transition);
            border-top: 5px solid var(--primary-color);
        }

        .feature:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-lg);
        }

        .feature i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            background-color: var(--primary-light);
            padding: 20px;
            border-radius: 50%;
        }

        .feature h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.4rem;
        }

        .feature p {
            color: var(--gray-color);
            font-size: 1rem;
        }

        /* Footer */
        footer {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px 0;
            margin-top: 60px;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            text-align: center;
        }

        .footer-links {
            display: flex;
            gap: 25px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .footer-link {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: var(--border-radius-sm);
        }

        .footer-link:hover {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .search-title {
                font-size: 2.5rem;
            }
            
            .sidebar {
                width: 100%;
                left: -100%;
            }
            
            .features {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-options {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .search-title {
                font-size: 2rem;
            }
            
            .search-container {
                padding: 20px;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .history-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .history-actions-container {
                align-self: flex-end;
            }
            
            .history-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-history-input {
                max-width: 100%;
            }
            
            .section-title {
                font-size: 1.7rem;
            }
            
            .stat-card {
                min-width: 100%;
            }
        }

        @media (max-width: 576px) {
            .header-content {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .logo {
                font-size: 1.4rem;
            }
            
            .search-title {
                font-size: 1.8rem;
            }
            
            .search-subtitle {
                font-size: 1rem;
            }
            
            .filter-modal {
                width: 95%;
                padding: 20px;
            }
            
            .filter-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        .shake-animation {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>
    <!-- Header with Menu Toggle -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-search-plus"></i>
                <span>Enhanced Search</span>
            </div>
            <div class="header-actions">
                <button class="voice-search-btn" id="voiceSearchBtn" title="Voice Search">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="search-filter-btn" id="searchFilterBtn" title="Search Filters">
                    <i class="fas fa-filter"></i>
                </button>
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Sidebar Menu -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">Smart Search</h2>
            <button class="close-menu" id="closeMenu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <ul class="menu-items">
            <li class="menu-item active" data-page="home">
                <a href="#">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
            </li>
            <li class="menu-item" data-page="history">
                <a href="#">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                    <span class="menu-badge" id="historyBadge">0</span>
                </a>
            </li>
            <li class="menu-item" data-page="favorites">
                <a href="#">
                    <i class="fas fa-star"></i>
                    <span>Favorites</span>
                    <span class="menu-badge" id="favoritesBadge">0</span>
                </a>
            </li>
            <li class="menu-item" id="darkModeToggle">
                <a href="#">
                    <i class="fas fa-moon"></i>
                    <span>Dark Mode</span>
                </a>
            </li>
            <li class="menu-item" data-page="about">
                <a href="#">
                    <i class="fas fa-info-circle"></i>
                    <span>About</span>
                </a>
            </li>
        </ul>
        <div class="sidebar-footer">
            <p>Enhanced Search App v2.0</p>
            <p>Powered by Google & AI</p>
        </div>
    </div>

    <!-- Search Filter Modal -->
    <div class="filter-modal" id="filterModal">
        <div class="filter-header">
            <h3 class="filter-title">Search Filters</h3>
            <button class="close-filter" id="closeFilter">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="filter-options">
            <div class="filter-group">
                <label class="filter-label">Search Type</label>
                <select class="filter-select" id="searchType">
                    <option value="web">Web Search</option>
                    <option value="images">Images</option>
                    <option value="news">News</option>
                    <option value="videos">Videos</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Region</label>
                <select class="filter-select" id="searchRegion">
                    <option value="global">Global</option>
                    <option value="us">United States</option>
                    <option value="uk">United Kingdom</option>
                    <option value="eu">Europe</option>
                    <option value="asia">Asia</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Time Range</label>
                <select class="filter-select" id="searchTime">
                    <option value="anytime">Anytime</option>
                    <option value="past24h">Past 24 hours</option>
                    <option value="pastWeek">Past week</option>
                    <option value="pastMonth">Past month</option>
                    <option value="pastYear">Past year</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Safe Search</label>
                <select class="filter-select" id="safeSearch">
                    <option value="moderate">Moderate</option>
                    <option value="strict">Strict</option>
                    <option value="off">Off</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Results per page</label>
                <input type="number" class="filter-input" id="resultsPerPage" min="5" max="50" value="10">
            </div>
            <div class="filter-group">
                <label class="filter-label">Language</label>
                <select class="filter-select" id="searchLanguage">
                    <option value="en">English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="zh">Chinese</option>
                </select>
            </div>
        </div>
        <div class="filter-actions">
            <button class="btn btn-secondary" id="resetFilters">Reset</button>
            <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
        </div>
    </div>

    <!-- Voice Search Interface -->
    <div class="voice-interface" id="voiceInterface">
        <button class="voice-close" id="closeVoice">
            <i class="fas fa-times"></i>
        </button>
        <div class="voice-icon">
            <i class="fas fa-microphone" id="voiceIcon"></i>
        </div>
        <div class="voice-text" id="voiceText">Click to start voice search</div>
        <button class="btn btn-primary" id="startVoiceSearch">
            <i class="fas fa-microphone"></i> Start Listening
        </button>
    </div>

    <!-- Overlay for closing menu and modals -->
    <div class="overlay" id="overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Home Section (Default) -->
            <section id="homeSection" class="page-section">
                <div class="search-section">
                    <h1 class="search-title">Enhanced Search Experience</h1>
                    <p class="search-subtitle">Discover information faster with voice search, filters, and intelligent results. Your searches are saved automatically and can be bookmarked for later.</p>
                    
                    <div class="search-container">
                        <!-- Google Custom Search Element -->
                        <div class="gcse-search"></div>
                        <div class="search-features">
                            <div class="feature-badge">
                                <i class="fas fa-microphone"></i>
                                <span>Voice Search</span>
                            </div>
                            <div class="feature-badge">
                                <i class="fas fa-filter"></i>
                                <span>Advanced Filters</span>
                            </div>
                            <div class="feature-badge">
                                <i class="fas fa-history"></i>
                                <span>Search History</span>
                            </div>
                            <div class="feature-badge">
                                <i class="fas fa-star"></i>
                                <span>Favorites</span>
                            </div>
                            <div class="feature-badge">
                                <i class="fas fa-moon"></i>
                                <span>Dark Mode</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="history-preview">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i>
                        Recent Searches
                    </h2>
                    <div class="history-section">
                        <ul class="history-list" id="previewHistoryList">
                            <!-- Recent searches will appear here -->
                        </ul>
                        <div class="no-history" id="previewNoHistory">
                            <i class="fas fa-search"></i>
                            <p>No recent searches yet. Start searching above!</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- History Section -->
            <section id="historySection" class="page-section hidden">
                <h2 class="section-title">
                    <i class="fas fa-history"></i>
                    Search History
                </h2>
                <div class="history-controls">
                    <input type="text" class="search-history-input" id="searchHistoryInput" placeholder="Search your history...">
                    <div class="history-actions">
                        <button class="btn btn-secondary" id="sortHistory">
                            <i class="fas fa-sort-amount-down"></i> Sort
                        </button>
                        <button class="btn btn-primary" id="exportHistory">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="btn btn-secondary" id="clearHistoryBtn">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                    </div>
                </div>
                <div class="history-section">
                    <ul class="history-list" id="fullHistoryList">
                        <!-- Full history will appear here -->
                    </ul>
                    <div class="no-history hidden" id="fullNoHistory">
                        <i class="fas fa-history"></i>
                        <p>No search history yet. Start searching from the home page!</p>
                    </div>
                </div>
            </section>

            <!-- Favorites Section -->
            <section id="favoritesSection" class="page-section hidden">
                <h2 class="section-title">
                    <i class="fas fa-star"></i>
                    Favorite Searches
                </h2>
                <div class="favorites-stats">
                    <div class="stat-card">
                        <i class="fas fa-star"></i>
                        <div class="stat-value" id="totalFavorites">0</div>
                        <div class="stat-label">Total Favorites</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <div class="stat-value" id="lastAdded">-</div>
                        <div class="stat-label">Last Added</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-fire"></i>
                        <div class="stat-value" id="topCategory">-</div>
                        <div class="stat-label">Top Category</div>
                    </div>
                </div>
                <div class="favorites-section">
                    <ul class="history-list" id="favoritesList">
                        <!-- Favorites will appear here -->
                    </ul>
                    <div class="no-favorites hidden" id="noFavorites">
                        <i class="fas fa-star"></i>
                        <p>No favorites yet. Click the star icon on any search to add it here!</p>
                    </div>
                </div>
            </section>

            <!-- About Section -->
            <section id="aboutSection" class="page-section hidden">
                <h2 class="section-title">
                    <i class="fas fa-info-circle"></i>
                    About Enhanced Search
                </h2>
                <div class="about-section">
                    <div class="about-content">
                        <p>Welcome to <strong>Enhanced Search</strong>, a next-generation search application that combines the power of Google's search engine with advanced features for a superior search experience.</p>
                        <p>This application goes beyond basic search with voice recognition, customizable filters, search history management, bookmarking, and a beautiful dark/light mode interface.</p>
                        
                        <div class="features">
                            <div class="feature">
                                <i class="fas fa-microphone-alt"></i>
                                <h3>Voice Search</h3>
                                <p>Use your voice to search the web hands-free with our advanced voice recognition</p>
                            </div>
                            <div class="feature">
                                <i class="fas fa-sliders-h"></i>
                                <h3>Advanced Filters</h3>
                                <p>Customize your search with region, time range, language, and safe search filters</p>
                            </div>
                            <div class="feature">
                                <i class="fas fa-star"></i>
                                <h3>Favorites</h3>
                                <p>Bookmark important searches for quick access and organize them by category</p>
                            </div>
                            <div class="feature">
                                <i class="fas fa-file-export"></i>
                                <h3>Export Data</h3>
                                <p>Export your search history and favorites as CSV or JSON for backup or analysis</p>
                            </div>
                            <div class="feature">
                                <i class="fas fa-chart-line"></i>
                                <h3>Search Analytics</h3>
                                <p>View statistics about your search habits and patterns over time</p>
                            </div>
                            <div class="feature">
                                <i class="fas fa-palette"></i>
                                <h3>Custom Themes</h3>
                                <p>Switch between light and dark modes with additional theme options</p>
                            </div>
                        </div>
                        
                        <p>This enhanced application is built with modern HTML5, CSS3, and JavaScript, showcasing responsive design, local storage management, and integration with Google's powerful search API.</p>
                        <p>All your data is stored locally in your browser for complete privacy and security.</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container footer-content">
            <div class="logo">
                <i class="fas fa-search-plus"></i>
                <span>Enhanced Search</span>
            </div>
            <p>Intelligent search experience with voice, filters, and analytics</p>
            <div class="footer-links">
                <a href="#" class="footer-link" data-page="home">Home</a>
                <a href="#" class="footer-link" data-page="history">History</a>
                <a href="#" class="footer-link" data-page="favorites">Favorites</a>
                <a href="#" class="footer-link" data-page="about">About</a>
                <a href="#" class="footer-link" id="toggleThemeFooter">Toggle Theme</a>
            </div>
            <p>Enhanced Search App &copy; 2023 | Powered by Google Custom Search</p>
        </div>
    </footer>

    <!-- Google Custom Search Script -->
    <script async src="https://cse.google.com/cse.js?cx=f39b5341435bd47dd"></script>
    
    <!-- Toastr for notifications -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <script>
        // Configure toastr
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "positionClass": "toast-bottom-right",
            "timeOut": "3000"
        };

        // DOM Elements
        const menuToggle = document.getElementById('menuToggle');
        const closeMenu = document.getElementById('closeMenu');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const toggleThemeFooter = document.getElementById('toggleThemeFooter');
        const menuItems = document.querySelectorAll('.menu-item[data-page]');
        const pageSections = document.querySelectorAll('.page-section');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const previewHistoryList = document.getElementById('previewHistoryList');
        const fullHistoryList = document.getElementById('fullHistoryList');
        const favoritesList = document.getElementById('favoritesList');
        const previewNoHistory = document.getElementById('previewNoHistory');
        const fullNoHistory = document.getElementById('fullNoHistory');
        const noFavorites = document.getElementById('noFavorites');
        const searchHistoryInput = document.getElementById('searchHistoryInput');
        const sortHistoryBtn = document.getElementById('sortHistory');
        const exportHistoryBtn = document.getElementById('exportHistory');
        const searchFilterBtn = document.getElementById('searchFilterBtn');
        const filterModal = document.getElementById('filterModal');
        const closeFilter = document.getElementById('closeFilter');
        const resetFiltersBtn = document.getElementById('resetFilters');
        const applyFiltersBtn = document.getElementById('applyFilters');
        const voiceSearchBtn = document.getElementById('voiceSearchBtn');
        const voiceInterface = document.getElementById('voiceInterface');
        const closeVoice = document.getElementById('closeVoice');
        const startVoiceSearchBtn = document.getElementById('startVoiceSearch');
        const voiceIcon = document.getElementById('voiceIcon');
        const voiceText = document.getElementById('voiceText');
        const historyBadge = document.getElementById('historyBadge');
        const favoritesBadge = document.getElementById('favoritesBadge');
        const totalFavorites = document.getElementById('totalFavorites');
        const lastAdded = document.getElementById('lastAdded');
        const topCategory = document.getElementById('topCategory');

        // Initialize data structures
        let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let searchFilters = JSON.parse(localStorage.getItem('searchFilters')) || {
            type: 'web',
            region: 'global',
            time: 'anytime',
            safeSearch: 'moderate',
            resultsPerPage: 10,
            language: 'en'
        };
        let voiceRecognition = null;
        let isListening = false;
        let sortOrder = 'newest';

        // Menu Toggle Functionality
        menuToggle.addEventListener('click', () => {
            sidebar.classList.add('active');
            overlay.classList.add('active');
        });

        closeMenu.addEventListener('click', () => {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        });

        overlay.addEventListener('click', () => {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            filterModal.classList.remove('active');
            voiceInterface.classList.remove('active');
        });

        // Dark Mode Toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            
            // Update dark mode icon
            const darkModeIcon = darkModeToggle.querySelector('i');
            const darkModeText = darkModeToggle.querySelector('span');
            if (document.body.classList.contains('dark-mode')) {
                darkModeIcon.className = 'fas fa-sun';
                darkModeText.textContent = 'Light Mode';
                localStorage.setItem('darkMode', 'enabled');
                toastr.success('Dark mode enabled');
            } else {
                darkModeIcon.className = 'fas fa-moon';
                darkModeText.textContent = 'Dark Mode';
                localStorage.setItem('darkMode', 'disabled');
                toastr.info('Light mode enabled');
            }
        }

        darkModeToggle.addEventListener('click', toggleDarkMode);
        toggleThemeFooter.addEventListener('click', (e) => {
            e.preventDefault();
            toggleDarkMode();
        });

        // Check for saved dark mode preference
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            const darkModeIcon = darkModeToggle.querySelector('i');
            darkModeIcon.className = 'fas fa-sun';
            darkModeToggle.querySelector('span').textContent = 'Light Mode';
        }

        // Page Navigation
        menuItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Get the page to show
                const pageToShow = item.getAttribute('data-page');
                
                // Update active menu item
                menuItems.forEach(menuItem => {
                    menuItem.classList.remove('active');
                });
                item.classList.add('active');
                
                // Show the selected page
                pageSections.forEach(section => {
                    section.classList.add('hidden');
                });
                
                document.getElementById(`${pageToShow}Section`).classList.remove('hidden');
                
                // Update content if needed
                if (pageToShow === 'history') {
                    updateHistoryList();
                } else if (pageToShow === 'favorites') {
                    updateFavoritesList();
                    updateFavoritesStats();
                }
                
                // Close menu on mobile
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            });
        });

        // Footer links navigation
        document.querySelectorAll('.footer-link[data-page]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageToShow = link.getAttribute('data-page');
                
                // Update active menu item
                menuItems.forEach(menuItem => {
                    menuItem.classList.remove('active');
                    if (menuItem.getAttribute('data-page') === pageToShow) {
                        menuItem.classList.add('active');
                    }
                });
                
                // Show the selected page
                pageSections.forEach(section => {
                    section.classList.add('hidden');
                });
                
                document.getElementById(`${pageToShow}Section`).classList.remove('hidden');
                
                // Update content if needed
                if (pageToShow === 'history') {
                    updateHistoryList();
                } else if (pageToShow === 'favorites') {
                    updateFavoritesList();
                    updateFavoritesStats();
                }
            });
        });

        // Search Filter Modal
        searchFilterBtn.addEventListener('click', () => {
            filterModal.classList.add('active');
            overlay.classList.add('active');
            loadFilterSettings();
        });

        closeFilter.addEventListener('click', () => {
            filterModal.classList.remove('active');
            overlay.classList.remove('active');
        });

        // Load filter settings from localStorage
        function loadFilterSettings() {
            document.getElementById('searchType').value = searchFilters.type;
            document.getElementById('searchRegion').value = searchFilters.region;
            document.getElementById('searchTime').value = searchFilters.time;
            document.getElementById('safeSearch').value = searchFilters.safeSearch;
            document.getElementById('resultsPerPage').value = searchFilters.resultsPerPage;
            document.getElementById('searchLanguage').value = searchFilters.language;
        }

        // Save filter settings
        function saveFilterSettings() {
            searchFilters = {
                type: document.getElementById('searchType').value,
                region: document.getElementById('searchRegion').value,
                time: document.getElementById('searchTime').value,
                safeSearch: document.getElementById('safeSearch').value,
                resultsPerPage: parseInt(document.getElementById('resultsPerPage').value),
                language: document.getElementById('searchLanguage').value
            };
            localStorage.setItem('searchFilters', JSON.stringify(searchFilters));
            toastr.success('Search filters applied successfully');
        }

        // Apply filters
        applyFiltersBtn.addEventListener('click', () => {
            saveFilterSettings();
            filterModal.classList.remove('active');
            overlay.classList.remove('active');
            // In a real app, you would apply these filters to the Google Search
            // For this demo, we'll just show a notification
        });

        // Reset filters
        resetFiltersBtn.addEventListener('click', () => {
            searchFilters = {
                type: 'web',
                region: 'global',
                time: 'anytime',
                safeSearch: 'moderate',
                resultsPerPage: 10,
                language: 'en'
            };
            loadFilterSettings();
            toastr.info('Filters reset to default');
        });

        // Voice Search Interface
        voiceSearchBtn.addEventListener('click', () => {
            voiceInterface.classList.add('active');
            overlay.classList.add('active');
        });

        closeVoice.addEventListener('click', () => {
            voiceInterface.classList.remove('active');
            overlay.classList.remove('active');
            stopVoiceRecognition();
        });

        // Initialize voice recognition
        function initVoiceRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                voiceText.textContent = "Voice recognition not supported in your browser";
                startVoiceSearchBtn.disabled = true;
                return;
            }
            
            voiceRecognition = new SpeechRecognition();
            voiceRecognition.continuous = false;
            voiceRecognition.interimResults = false;
            voiceRecognition.lang = 'en-US';
            
            voiceRecognition.onstart = () => {
                isListening = true;
                voiceIcon.classList.add('voice-listening');
                voiceText.textContent = "Listening... Speak now!";
                startVoiceSearchBtn.innerHTML = '<i class="fas fa-stop"></i> Stop Listening';
                toastr.info('Voice recognition started');
            };
            
            voiceRecognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                voiceText.textContent = `You said: "${transcript}"`;
                
                // Set the search box value
                const searchBox = document.querySelector('input.gsc-input');
                if (searchBox) {
                    searchBox.value = transcript;
                    
                    // Trigger search
                    setTimeout(() => {
                        const searchButton = document.querySelector('.gsc-search-button');
                        if (searchButton) {
                            searchButton.click();
                        }
                    }, 500);
                    
                    // Add to history
                    addToHistory(transcript);
                }
                
                toastr.success(`Searching for: "${transcript}"`);
            };
            
            voiceRecognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                voiceText.textContent = `Error: ${event.error}. Try again.`;
                toastr.error(`Voice recognition error: ${event.error}`);
                stopVoiceRecognition();
            };
            
            voiceRecognition.onend = () => {
                stopVoiceRecognition();
            };
        }

        function startVoiceRecognition() {
            if (!voiceRecognition) {
                initVoiceRecognition();
            }
            
            if (isListening) {
                stopVoiceRecognition();
            } else {
                try {
                    voiceRecognition.start();
                } catch (error) {
                    console.error('Error starting voice recognition:', error);
                    voiceText.textContent = "Error starting voice recognition";
                    toastr.error('Error starting voice recognition');
                }
            }
        }

        function stopVoiceRecognition() {
            if (voiceRecognition && isListening) {
                voiceRecognition.stop();
            }
            isListening = false;
            voiceIcon.classList.remove('voice-listening');
            voiceText.textContent = "Click to start voice search";
            startVoiceSearchBtn.innerHTML = '<i class="fas fa-microphone"></i> Start Listening';
        }

        startVoiceSearchBtn.addEventListener('click', startVoiceRecognition);

        // Initialize voice recognition on page load
        initVoiceRecognition();

        // Function to add a search to history
        function addToHistory(query) {
            // Check if this query was just searched (within last minute)
            const now = new Date();
            const oneMinuteAgo = new Date(now.getTime() - 60000);
            
            const recentDuplicate = searchHistory.find(entry => {
                const entryTime = new Date(entry.timestamp);
                return entry.query.toLowerCase() === query.toLowerCase() && entryTime > oneMinuteAgo;
            });
            
            if (recentDuplicate) {
                // Update timestamp of existing entry
                recentDuplicate.timestamp = now.toISOString();
                localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
                updatePreviewHistory();
                updateBadges();
                return;
            }
            
            const searchEntry = {
                id: Date.now(),
                query: query,
                timestamp: now.toISOString(),
                isFavorite: false,
                category: detectCategory(query)
            };
            
            searchHistory.unshift(searchEntry);
            
            // Keep only the last 100 searches
            if (searchHistory.length > 100) {
                searchHistory = searchHistory.slice(0, 100);
            }
            
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
            updatePreviewHistory();
            updateBadges();
            
            toastr.success('Search added to history');
        }

        // Detect category from query
        function detectCategory(query) {
            const queryLower = query.toLowerCase();
            
            if (queryLower.includes('how to') || queryLower.includes('tutorial') || queryLower.includes('guide')) {
                return 'Tutorial';
            } else if (queryLower.includes('news') || queryLower.includes('update') || queryLower.includes('latest')) {
                return 'News';
            } else if (queryLower.includes('image') || queryLower.includes('photo') || queryLower.includes('picture')) {
                return 'Images';
            } else if (queryLower.includes('video') || queryLower.includes('youtube') || queryLower.includes('watch')) {
                return 'Videos';
            } else if (queryLower.includes('buy') || queryLower.includes('price') || queryLower.includes('shop')) {
                return 'Shopping';
            } else if (queryLower.includes('recipe') || queryLower.includes('food') || queryLower.includes('cook')) {
                return 'Food';
            } else if (queryLower.includes('weather') || queryLower.includes('forecast')) {
                return 'Weather';
            } else if (queryLower.includes('movie') || queryLower.includes('film') || queryLower.includes('actor')) {
                return 'Entertainment';
            } else {
                return 'General';
            }
        }

        // Function to update the preview history (home page)
        function updatePreviewHistory() {
            previewHistoryList.innerHTML = '';
            
            if (searchHistory.length === 0) {
                previewNoHistory.classList.remove('hidden');
                return;
            }
            
            previewNoHistory.classList.add('hidden');
            
            // Show only the 5 most recent searches
            const recentSearches = searchHistory.slice(0, 5);
            
            recentSearches.forEach(entry => {
                const isFav = favorites.some(fav => fav.id === entry.id);
                const li = createHistoryItem(entry, isFav);
                previewHistoryList.appendChild(li);
            });
        }

        // Function to update the full history list (history page)
        function updateHistoryList(filterText = '') {
            fullHistoryList.innerHTML = '';
            
            let filteredHistory = searchHistory;
            
            // Apply search filter if provided
            if (filterText) {
                filteredHistory = searchHistory.filter(entry => 
                    entry.query.toLowerCase().includes(filterText.toLowerCase()) ||
                    entry.category.toLowerCase().includes(filterText.toLowerCase())
                );
            }
            
            // Apply sorting
            filteredHistory = sortHistory(filteredHistory, sortOrder);
            
            if (filteredHistory.length === 0) {
                fullNoHistory.classList.remove('hidden');
                return;
            }
            
            fullNoHistory.classList.add('hidden');
            
            filteredHistory.forEach(entry => {
                const isFav = favorites.some(fav => fav.id === entry.id);
                const li = createHistoryItem(entry, isFav);
                fullHistoryList.appendChild(li);
            });
        }

        // Function to sort history
        function sortHistory(history, order) {
            const sortedHistory = [...history];
            
            if (order === 'newest') {
                sortedHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            } else if (order === 'oldest') {
                sortedHistory.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            } else if (order === 'az') {
                sortedHistory.sort((a, b) => a.query.localeCompare(b.query));
            } else if (order === 'za') {
                sortedHistory.sort((a, b) => b.query.localeCompare(a.query));
            }
            
            return sortedHistory;
        }

        // Create a history item element
        function createHistoryItem(entry, isFavorite) {
            const li = document.createElement('li');
            li.className = `history-item ${isFavorite ? 'favorite' : ''}`;
            li.setAttribute('data-id', entry.id);
            
            const timeAgo = getTimeAgo(entry.timestamp);
            
            li.innerHTML = `
                <div class="history-item-content">
                    <div class="history-query">
                        <i class="fas fa-search"></i>
                        ${entry.query}
                    </div>
                    <div class="history-time">
                        <i class="far fa-clock"></i>
                        ${timeAgo}  ${entry.category}
                    </div>
                </div>
                <div class="history-actions-container">
                    <button class="history-btn favorite-btn" title="${isFavorite ? 'Remove from favorites' : 'Add to favorites'}">
                        <i class="${isFavorite ? 'fas' : 'far'} fa-star"></i>
                    </button>
                    <button class="history-btn export-btn" title="Export this search">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="history-btn delete-btn" title="Delete this search">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            // Add event listeners to buttons
            const favoriteBtn = li.querySelector('.favorite-btn');
            const exportBtn = li.querySelector('.export-btn');
            const deleteBtn = li.querySelector('.delete-btn');
            
            favoriteBtn.addEventListener('click', () => toggleFavorite(entry.id));
            exportBtn.addEventListener('click', () => exportSingleSearch(entry));
            deleteBtn.addEventListener('click', () => deleteHistoryItem(entry.id));
            
            // Make the entire item clickable to search again
            li.addEventListener('click', (e) => {
                if (!e.target.closest('.history-actions-container')) {
                    performSearch(entry.query);
                }
            });
            
            return li;
        }

        // Toggle favorite status
        function toggleFavorite(id) {
            const historyItem = searchHistory.find(item => item.id === id);
            if (!historyItem) return;
            
            const favIndex = favorites.findIndex(fav => fav.id === id);
            
            if (favIndex === -1) {
                // Add to favorites
                favorites.push({
                    ...historyItem,
                    favoritedAt: new Date().toISOString()
                });
                toastr.success('Added to favorites');
            } else {
                // Remove from favorites
                favorites.splice(favIndex, 1);
                toastr.info('Removed from favorites');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateHistoryList();
            updatePreviewHistory();
            updateFavoritesList();
            updateFavoritesStats();
            updateBadges();
        }

        // Export single search
        function exportSingleSearch(search) {
            const dataStr = JSON.stringify(search, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `search-${search.id}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            toastr.success('Search exported successfully');
        }

        // Function to delete a history item
        function deleteHistoryItem(id) {
            if (!confirm('Are you sure you want to delete this search from history?')) {
                return;
            }
            
            // Remove from search history
            searchHistory = searchHistory.filter(entry => entry.id !== id);
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
            
            // Remove from favorites if present
            favorites = favorites.filter(fav => fav.id !== id);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            
            updateHistoryList();
            updatePreviewHistory();
            updateFavoritesList();
            updateFavoritesStats();
            updateBadges();
            
            toastr.success('Search deleted');
        }

        // Clear all history
        clearHistoryBtn.addEventListener('click', () => {
            if (!confirm('Are you sure you want to clear ALL search history? This cannot be undone.')) {
                return;
            }
            
            searchHistory = [];
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
            
            // Note: We don't clear favorites here
            updateHistoryList();
            updatePreviewHistory();
            updateBadges();
            
            toastr.success('All history cleared');
        });

        // Search history input
        searchHistoryInput.addEventListener('input', (e) => {
            updateHistoryList(e.target.value);
        });

        // Sort history
        let sortOptions = ['newest', 'oldest', 'az', 'za'];
        let sortIndex = 0;
        
        sortHistoryBtn.addEventListener('click', () => {
            sortIndex = (sortIndex + 1) % sortOptions.length;
            sortOrder = sortOptions[sortIndex];
            
            const sortIcons = {
                'newest': 'fa-sort-amount-down',
                'oldest': 'fa-sort-amount-up',
                'az': 'fa-sort-alpha-down',
                'za': 'fa-sort-alpha-up'
            };
            
            const sortText = {
                'newest': 'Newest',
                'oldest': 'Oldest',
                'az': 'A-Z',
                'za': 'Z-A'
            };
            
            sortHistoryBtn.innerHTML = `<i class="fas ${sortIcons[sortOrder]}"></i> ${sortText[sortOrder]}`;
            updateHistoryList(searchHistoryInput.value);
            
            toastr.info(`Sorted by: ${sortText[sortOrder]}`);
        });

        // Export all history
        exportHistoryBtn.addEventListener('click', () => {
            if (searchHistory.length === 0) {
                toastr.warning('No history to export');
                return;
            }
            
            const dataStr = JSON.stringify(searchHistory, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `search-history-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            toastr.success('History exported successfully');
        });

        // Update favorites list
        function updateFavoritesList() {
            favoritesList.innerHTML = '';
            
            if (favorites.length === 0) {
                noFavorites.classList.remove('hidden');
                return;
            }
            
            noFavorites.classList.add('hidden');
            
            // Sort favorites by most recently added
            const sortedFavorites = [...favorites].sort((a, b) => 
                new Date(b.favoritedAt || b.timestamp) - new Date(a.favoritedAt || a.timestamp)
            );
            
            sortedFavorites.forEach(fav => {
                const li = createHistoryItem(fav, true);
                favoritesList.appendChild(li);
            });
        }

        // Update favorites statistics
        function updateFavoritesStats() {
            totalFavorites.textContent = favorites.length;
            
            if (favorites.length > 0) {
                // Last added favorite
                const lastFavorite = [...favorites].sort((a, b) => 
                    new Date(b.favoritedAt || b.timestamp) - new Date(a.favoritedAt || a.timestamp)
                )[0];
                
                const lastAddedTime = getTimeAgo(lastFavorite.favoritedAt || lastFavorite.timestamp);
                lastAdded.textContent = lastAddedTime;
                
                // Top category
                const categories = {};
                favorites.forEach(fav => {
                    categories[fav.category] = (categories[fav.category] || 0) + 1;
                });
                
                let topCategoryName = 'General';
                let maxCount = 0;
                
                for (const [category, count] of Object.entries(categories)) {
                    if (count > maxCount) {
                        maxCount = count;
                        topCategoryName = category;
                    }
                }
                
                topCategory.textContent = topCategoryName;
            } else {
                lastAdded.textContent = '-';
                topCategory.textContent = '-';
            }
        }

        // Update badges
        function updateBadges() {
            historyBadge.textContent = searchHistory.length;
            favoritesBadge.textContent = favorites.length;
        }

        // Perform a search
        function performSearch(query) {
            const searchBox = document.querySelector('input.gsc-input');
            if (searchBox) {
                searchBox.value = query;
                
                // Trigger search
                setTimeout(() => {
                    const searchButton = document.querySelector('.gsc-search-button');
                    if (searchButton) {
                        searchButton.click();
                    }
                }, 100);
                
                // Switch to home page
                menuItems.forEach(menuItem => {
                    menuItem.classList.remove('active');
                    if (menuItem.getAttribute('data-page') === 'home') {
                        menuItem.classList.add('active');
                    }
                });
                
                pageSections.forEach(section => {
                    section.classList.add('hidden');
                });
                
                document.getElementById('homeSection').classList.remove('hidden');
                
                // Add to history
                addToHistory(query);
            }
        }

        // Format time ago
        function getTimeAgo(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) {
                return 'Just now';
            } else if (diffMins < 60) {
                return `${diffMins}m ago`;
            } else if (diffHours < 24) {
                return `${diffHours}h ago`;
            } else if (diffDays < 7) {
                return `${diffDays}d ago`;
            } else {
                return date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
                });
            }
        }

        // Monitor Google Custom Search for queries
        function monitorGoogleSearch() {
            // Check for search box
            const searchBox = document.querySelector('input.gsc-input');
            
            if (searchBox) {
                // Add event listener for when user presses Enter
                searchBox.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && this.value.trim() !== '') {
                        addToHistory(this.value.trim());
                        
                        // Update history preview after a short delay
                        setTimeout(() => {
                            updatePreviewHistory();
                            updateBadges();
                        }, 500);
                    }
                });
                
                // Also monitor the search button
                const searchButton = document.querySelector('.gsc-search-button');
                if (searchButton) {
                    searchButton.addEventListener('click', function() {
                        setTimeout(() => {
                            if (searchBox.value.trim() !== '') {
                                addToHistory(searchBox.value.trim());
                                setTimeout(() => {
                                    updatePreviewHistory();
                                    updateBadges();
                                }, 500);
                            }
                        }, 100);
                    });
                }
            } else {
                // If search box not found yet, try again after a short delay
                setTimeout(monitorGoogleSearch, 500);
            }
        }

        // Initialize the app
        function init() {
            updatePreviewHistory();
            updateFavoritesList();
            updateFavoritesStats();
            updateBadges();
            
            // Start monitoring Google Custom Search
            setTimeout(monitorGoogleSearch, 1000);
            
            // Add some sample history if empty
            if (searchHistory.length === 0) {
                const sampleSearches = [
                    "Responsive web design trends 2023",
                    "JavaScript best practices for beginners",
                    "How to bake chocolate chip cookies",
                    "Latest technology news",
                    "Beautiful nature wallpapers",
                    "Python machine learning tutorial",
                    "Healthy breakfast recipes",
                    "Travel destinations in Europe"
                ];
                
                // Add sample searches with different timestamps
                sampleSearches.forEach((query, index) => {
                    const timestamp = new Date();
                    timestamp.setHours(timestamp.getHours() - index * 3);
                    
                    const searchEntry = {
                        id: Date.now() - index * 10000,
                        query: query,
                        timestamp: timestamp.toISOString(),
                        isFavorite: Math.random() > 0.7,
                        category: detectCategory(query)
                    };
                    
                    searchHistory.push(searchEntry);
                    
                    // Add some to favorites
                    if (searchEntry.isFavorite) {
                        favorites.push({
                            ...searchEntry,
                            favoritedAt: new Date(timestamp.getTime() + 1000000).toISOString()
                        });
                    }
                });
                
                localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
                localStorage.setItem('favorites', JSON.stringify(favorites));
                
                updatePreviewHistory();
                updateFavoritesList();
                updateFavoritesStats();
                updateBadges();
            }
            
            // Apply saved filters to UI
            loadFilterSettings();
            
            // Show welcome message
            setTimeout(() => {
                toastr.info('Welcome to Enhanced Search! Try voice search or filters for a better experience.');
            }, 1000);
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>